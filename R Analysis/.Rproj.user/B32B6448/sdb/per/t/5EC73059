{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Reverse Correlation Expt 3 Analysis\"\nautor: \"Patrick Laflamme\"\noutput: html_document\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\nlibrary(dplyr)\nlibrary(R.matlab)\nlibrary(ggplot2)\nlibrary(psych)\nlibrary(cowplot)\n```\n\n## Define Some Important Functions\n\n```{r Function Definitions}\nimport_PartData <- function(fileDir){\n  #get files in given path\n  files <- list.files(path = fileDir, \".csv\", full.names = T)\n  \n  #marker to create new dataframe\n  new <- T\n  \n  #do for each file in the directory\n  for(file in files){\n    \n    #read the file into a dataframe\n    data <- read.csv(file, row.names=NULL,stringsAsFactors = F)\n    \n    #if this is the first one, create an output dataframe\n    if(new){\n      outdata <- data\n      new <- F\n    }\n    else{\n      #otherwise append it to the existing dataframe\n      outdata <- rbind(outdata, data)\n    }\n    \n  }\n  \n  #column name housekeeping\n  age <- colnames(outdata)[2]\n  colnames(outdata)[2]<- colnames(outdata)[3]\n  colnames(outdata)[3]<- age\n  \n  #convert to factors and do some more datacleaning\n  outdata <- outdata %>% mutate(Answer = as.numeric(replace(Answer, Answer==\"NULL\", NA)), Repeat. = as.numeric(replace(Repeat., Repeat. != \"0\", \"1\")), Target_Type = as.factor(Target_Type), Experiment_Phase = as.factor(Experiment_Phase)) %>% as.data.frame()\n  \n  #Response is reverse coded, so fix that.\n  outdata <- outdata %>% mutate(Response = as.numeric(Response)*-1 + 1) %>% as.data.frame()\n  \n  #create the condition variable - forgot to add to code (oops! - good thing we recorded it by hand too)\n  ActiveVPassive <- list(\"1\"=\"Active\", \"2\"=\"Active\", \"3\"=\"Passive\",\"4\"=\"Passive\", \"5\"=\"Active\", \"6\"=\"Active\",\"7\"=\"Passive\", \"8\"=\"Passive\", \"9\"=\"Active\", \"10\"=\"Active\", \"11\"=\"Passive\", \"12\"=\"Passive\", \"13\"=\"Active\", \"14\"=\"Active\", \"15\"=\"Passive\", \"16\"=\"Passive\", \"17\"=\"Active\", \"18\"=\"Active\")\n  \n  outdata <- mutate(outdata, Condition = unlist(ActiveVPassive[Participant_Number]))\n  \n  outdata$Condition <- as.factor(outdata$Condition)\n  \n  return(outdata)\n}\n\ncalculate_imageWise_correlations <- function(fileDir, partData, targetFile){\n  #find the .mat files in the given directory.\n  files <- list.files(fileDir, full.names = T, pattern = \".mat\")\n  \n  #get all of the IDs to search the files for\n  IDs <- as.character(unique(interaction(partData$Participant_Number, partData$Session_Number, sep=\"_\")))\n  \n  #Now load the targets before the loop. readMat is slow, let's do it as few times as possible.\n  targets <- readMat(targetFile)\n  \n  partData$RelevantImageWiseCorrelation <- NA\n  partData$nonRelevantImageWiseCorrelation <- NA\n  \n  #iterate through the IDs\n  for(ID in IDs){\n    \n    #convert ID to numbers for accessing PartData\n    ParticipantNumber <- as.numeric(strsplit(ID, \"_\")[[1]][1])\n    SessionNumber <- as.numeric(strsplit(ID, \"_\")[[1]][2])\n    TargetID <- as.numeric(unique(filter(partData, Participant_Number == ParticipantNumber, Session_Number == SessionNumber)$Target_Type))\n    \n    #select the relevant file.\n    file <- files[grep(paste(\"/\",ID,\".mat\",sep=''), files)]\n    \n    #load the relevant file.\n    data <- readMat(file)\n    \n    #Discard data that isn't useful\n    data <- array(aperm(data$whitenoise[,,1:500], c(2,1,3)), c(2500,500))\n    \n    #load the appropriate target image into memory.\n    correctTargetImage <- array(t(targets[[TargetID]]), c(2500))\n    incorrectTargetImage <- array(targets[[-TargetID]], c(2500))\n    \n    #now calculate the correlations\n    correctCorrelations <- apply(data, 2, cor, y=correctTargetImage)\n    incorrectCorrelations <- apply(data, 2, cor, y=incorrectTargetImage)\n    \n    partData$RelevantImageWiseCorrelation[partData$Participant_Number==ParticipantNumber & partData$Session_Number==SessionNumber & partData$Experiment_Phase==\"experimental\"] <- correctCorrelations[partData$Trial_Number[partData$Participant_Number==ParticipantNumber & partData$Session_Number==SessionNumber & partData$Experiment_Phase==\"experimental\"]]\n    \n    partData$nonRelevantImageWiseCorrelation[partData$Participant_Number==ParticipantNumber & partData$Session_Number==SessionNumber & partData$Experiment_Phase==\"experimental\"] <- incorrectCorrelations[partData$Trial_Number[partData$Participant_Number==ParticipantNumber & partData$Session_Number==SessionNumber & partData$Experiment_Phase==\"experimental\"]]\n    \n    \n  }\n  \n  return(partData)\n}\n\ncalculate_CI_correlations <- function(fileDir, partData, EXPNAME='EXP2'){\n  #find the .mat files in the given directory.\n  files <- list.files(fileDir, full.names = T, pattern = \".mat\")\n  \n  #get all of the IDs to search the files for\n  IDs <- as.character(unique(interaction(partData$Participant_Number, partData$Session_Number, sep=\"_\")))\n  \n  #iterate through the IDs\n  for(ID in IDs){\n    \n    #convert ID to numbers for accessing PartData\n    ParticipantNumber <- as.numeric(strsplit(ID, \"_\")[[1]][1])\n    SessionNumber <- as.numeric(strsplit(ID, \"_\")[[1]][2])\n    TargetID <- as.numeric(unique(filter(partData, Participant_Number == ParticipantNumber, Session_Number == SessionNumber)$Target_Type))\n    \n    #select the relevant file.\n    file <- files[grep(paste(\"/\",ID,\".mat\",sep=''), files)]\n    \n    #load the relevant file.\n    data <- readMat(file)\n    \n    #Discard data that isn't useful\n    data <- array(aperm(data$whitenoise,c(2,1,3)), c(2500,2000))\n    \n    data <- data[,partData$Trial_Number[partData$Participant_Number==ParticipantNumber & partData$Session_Number==SessionNumber & partData$Experiment_Phase==\"experimental\"]]\n    \n    responses <- partData$Response[partData$Participant_Number==ParticipantNumber & partData$Session_Number==SessionNumber & partData$Experiment_Phase==\"experimental\"]*2 - 1\n    \n    data <- t(t(data) * responses)\n    \n    if(SessionNumber==1){\n      assign(paste0('image', ParticipantNumber), as.matrix(rowSums(data), nrow=1))\n    }\n    else{\n      assign(paste0('image', ParticipantNumber), cbind(get(paste0('image', ParticipantNumber)), as.matrix(rowSums(data), nrow=1)))\n      \n      toPNG <- imager::as.cimg(rowSums(get(paste0('image', ParticipantNumber))))\n      \n      imager::save.image(toPNG, file = paste0(\"CIs/\",EXPNAME,\"/\", ParticipantNumber, \".png\"))\n    }\n    \n  }\n  \n  for(ID in IDs){\n    \n    #convert ID to numbers for accessing PartData\n    ParticipantNumber <- as.numeric(strsplit(ID, \"_\")[[1]][1])\n    SessionNumber <- as.numeric(strsplit(ID, \"_\")[[1]][2])\n    TargetID <- as.numeric(unique(filter(partData, Participant_Number == ParticipantNumber, Session_Number == SessionNumber)$Target_Type))\n    \n    #select the relevant file.\n    file <- files[grep(paste(\"/\",ID,\".mat\",sep=''), files)]\n    \n    #load the relevant file.\n    data <- readMat(file)\n    \n    #Discard data that isn't useful\n    data <- array(aperm(data$whitenoise,c(2,1,3)), c(2500,2000))\n    \n    #now calculate the correlations\n    CICorrelations <- apply(data, 2, cor, y=rowSums(get(paste0('image', ParticipantNumber))))\n    #incorrectCorrelations <- apply(data, 2, cor, y=incorrectTargetImage)\n    \n    partData$CIImageWiseCorrelation[partData$Participant_Number==ParticipantNumber & partData$Session_Number==SessionNumber & partData$Experiment_Phase==\"experimental\"] <- CICorrelations[partData$Trial_Number[partData$Participant_Number==ParticipantNumber & partData$Session_Number==SessionNumber & partData$Experiment_Phase==\"experimental\"]]\n    \n  }\n  return(partData)\n}\n\ncalc_dprime <- function(data){\n  \n  pFAs <- summarise(group_by(filter(data, Answer==0), Participant_Number, Experiment_Phase, Condition), pFAs=mean(Response))\n  \n  pHIT <- summarise(group_by(filter(data, Answer==1), Participant_Number, Experiment_Phase), pHIT=mean(Response))\n  \n  output <- merge(pHIT, pFAs)\n  \n  output <- mutate(output, pHIT = plyr::mapvalues(pHIT, from = c(0, 1), to = c(1/(80*2), (80*2-1)/(80*2))), pFAs = plyr::mapvalues(pFAs, from = c(0, 1), to = c(1/(80*2), (80*2-1)/(80*2))))\n  \n  output <- mutate(output, dprime = qnorm(pHIT) - qnorm(pFAs), ln_beta = (qnorm(pFAs)**2 - qnorm(pHIT)**2)/2)\n  \n  return(output)\n}\n\n\n```\n\n## Import the Data and Add the Active v Passive designations.\n\nHere we will import the data, add the associated Active v Passive Designations, and then separate the training vs. experimental data.\n\n```{r Import Data}\n\nParticipantData <- import_PartData(\"EXP3_csv_data/\")\n\nParticipantDataCorrelations <- calculate_imageWise_correlations(\"/Volumes/Storage/Experiment_Data/Reverse_Correlation_EXP3\", ParticipantData, \"targets.mat\")\n\nParticipantDataCorrelations <- calculate_CI_correlations(\"/Volumes/Storage/Experiment_Data/Reverse_Correlation_EXP3\", ParticipantDataCorrelations, EXPNAME = 'EXP3')\n\nExperimentalData <- filter(ParticipantDataCorrelations, Experiment_Phase == \"experimental\")\n\nTrainingData <- filter(ParticipantDataCorrelations, Experiment_Phase != \"experimental\")\n\n```\n\n## Training Data Analysis\n\nFirst let's use our dprime function to calculate dprime for the hard and easy practice sessions. This will help us get an idea of who is good at this, and who is bad at it. It will also clearly identify who just didn't get it.\n\n```{r Training Data, warning=FALSE}\nTrainingDprimes <-calc_dprime(TrainingData)\n```\n\nLet's plot the results.\n\n### Dprime\n\n```{r Dprime Plot, echo=FALSE}\n#create the plot.\nplot(filter(TrainingDprimes, Experiment_Phase=='easy')$dprime, filter(TrainingDprimes, Experiment_Phase=='hard')$dprime, pch=16, xlab = 'Dprime in Easy Phase', ylab = \"Dprime in Hard Phase\", col = c(\"black\",\"blue\")[filter(TrainingDprimes, Experiment_Phase=='easy')$Condition])\n\n#add participant number labels to make it easier to identify outliers.\ntext(filter(TrainingDprimes, Experiment_Phase=='easy')$dprime - 0.1, filter(TrainingDprimes, Experiment_Phase=='hard')$dprime, labels = filter(TrainingDprimes, Experiment_Phase=='easy')$Participant_Number,cex = 0.5)\n\nlegend(\"topleft\", legend = levels(filter(TrainingDprimes, Experiment_Phase=='easy')$Condition), pch = c(16,16), col = c('black', 'blue'))\n\n```\n\nClearly, #9 didn't get the instructions. Somehow 1 and 6 didn't get it much either after the easy session.... \n\n### P(hits)\n\n```{r pHIT Plot, echo=FALSE}\n#create the plot.\nplot(filter(TrainingDprimes, Experiment_Phase=='easy')$pHIT, filter(TrainingDprimes, Experiment_Phase=='hard')$pHIT, pch=16, xlab = 'P(hits) in Easy Phase', ylab = \"P(hits) in Hard Phase\", col = c(\"black\",\"blue\")[filter(TrainingDprimes, Experiment_Phase=='easy')$Condition])\n\n#add participant number labels to make it easier to identify outliers.\ntext(filter(TrainingDprimes, Experiment_Phase=='easy')$pHIT - 0.01, filter(TrainingDprimes, Experiment_Phase=='hard')$pHIT, labels = filter(TrainingDprimes, Experiment_Phase=='easy')$Participant_Number,cex = 0.5)\n\nlegend(\"topleft\", legend = levels(filter(TrainingDprimes, Experiment_Phase=='easy')$Condition), pch = c(16,16), col = c('black', 'blue'))\n\n```\n\n### Ph(false alarms)\n\n```{r pFAs Plot, echo=FALSE}\n#create the plot.\nplot(filter(TrainingDprimes, Experiment_Phase=='easy')$pFAs, filter(TrainingDprimes, Experiment_Phase=='hard')$pFAs, pch=16, xlab = 'P(FAs) in Easy Phase', ylab = \"P(FAs) in Hard Phase\", col = c(\"black\",\"blue\")[filter(TrainingDprimes, Experiment_Phase=='easy')$Condition])\n\n#add participant number labels to make it easier to identify outliers.\ntext(filter(TrainingDprimes, Experiment_Phase=='easy')$pFAs - 0.05, filter(TrainingDprimes, Experiment_Phase=='hard')$pFAs, labels = filter(TrainingDprimes, Experiment_Phase=='easy')$Participant_Number,cex = 0.5)\n\nlegend(\"topleft\", legend = levels(filter(TrainingDprimes, Experiment_Phase=='easy')$Condition), pch = c(16,16), col = c('black', 'blue'))\n\n```\n\n\n### ln(Beta)\n\n```{r ln(Beta) Plot, echo=FALSE}\n#create the plot.\nplot(filter(TrainingDprimes, Experiment_Phase=='easy')$ln_beta, filter(TrainingDprimes, Experiment_Phase=='hard')$ln_beta, pch=16, xlab = 'ln(Beta) in Easy Phase', ylab = \"ln(Beta) in Hard Phase\", col = c(\"black\",\"blue\")[filter(TrainingDprimes, Experiment_Phase=='easy')$Condition])\n\n#add participant number labels to make it easier to identify outliers.\ntext(filter(TrainingDprimes, Experiment_Phase=='easy')$ln_beta - 0.1, filter(TrainingDprimes, Experiment_Phase=='hard')$ln_beta, labels = filter(TrainingDprimes, Experiment_Phase=='easy')$Participant_Number,cex = 0.5)\n\nlegend(\"topleft\", legend = levels(filter(TrainingDprimes, Experiment_Phase=='easy')$Condition), pch = c(16,16), col = c('black', 'blue'))\n\n```\n\n## Coherent training phase summary\n\n```{r Report average training data values}\nSummary_Dprime_data <- summarise(group_by(TrainingDprimes, Experiment_Phase, Condition), MeanPhit = mean(pHIT), SEpHit = sd(pHIT)/sqrt(n()),  MeanpFAs = mean(pFAs), SEpFAs = sd(pFAs)/sqrt(n()),  Meandprime = mean(dprime), SEdprime = sd(dprime)/sqrt(n()), Meanln_beta = mean(ln_beta), SEln_beta = sd(ln_beta)/sqrt(n()))\n\n\nSummary_Dprime_data\n```\n\n### Dprime\n\n```{r Dprime summary plot}\n#make the bars slightly separated for visual pleasure\ndodge <- position_dodge(width = 0.91)\n\n#define the error bar limits\nlimits <- aes(ymax = Summary_Dprime_data$Meandprime + Summary_Dprime_data$SEdprime,\n              ymin = Summary_Dprime_data$Meandprime - Summary_Dprime_data$SEdprime)\n\n#start the plot\np <- ggplot(data =Summary_Dprime_data, aes(x = Experiment_Phase, y = Meandprime, fill = Condition))\n\n#now fill the plot\ndprimePlot <- p + geom_bar(stat = \"identity\", position = dodge) +\n  geom_errorbar(limits, position = dodge, width = 0.25) +\n  theme_bw() +\n  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+\n  labs(y = \"Dprime\")+\n  ggtitle(\"Dprime by Experiment Phase\") +\n  guides(fill=FALSE) + \n  scale_fill_manual(values=c(\"red\", \"blue\"))\n\n#clean up the environment.\nremove(p, dodge, limits)\n\n```\n\n\n### ln_beta\n\n```{r ln_beta summary plot}\n#make the bars slightly separated for visual pleasure\ndodge <- position_dodge(width = 0.91)\n\n#define the error bar limits\nlimits <- aes(ymax = Summary_Dprime_data$Meanln_beta + Summary_Dprime_data$SEln_beta,\n              ymin = Summary_Dprime_data$Meanln_beta - Summary_Dprime_data$SEln_beta)\n\n#start the plot\np <- ggplot(data =Summary_Dprime_data, aes(x = Experiment_Phase, y = Meanln_beta, fill = Condition))\n\n#now fill the plot\nln_betaPlot <- p + geom_bar(stat = \"identity\", position = dodge) +\n  geom_errorbar(limits, position = dodge, width = 0.25) +\n  theme_bw() +\n  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+\n  labs(y = \"Log(Beta)\")+\n  ggtitle(\"Log(Beta) by Experiment Phase\") + \n  scale_fill_manual(values=c(\"red\", \"blue\"))\n\n#clean up the environment.\nremove(p, dodge, limits)\n\nplot_grid(dprimePlot, ln_betaPlot, rel_widths = c(1,1.5))\n\n```\n\n\n## Experimental Data Summary\n\n```{r Summarize Experimental Phase}\nExperimental_Summary_Overall <- summarise(ExperimentalData, meanAge = mean(Age), sdAge = sd(Age), propYes = mean(Response), maxRT = max(RT), minRT = min(RT), sdRT = sd(RT), meanRT = mean(RT), total_trials = n())\n\n Experimental_Summary_byPRTCPNT <- summarise(group_by(ExperimentalData, Participant_Number), propYes = mean(Response), numYes = sum(Response), maxRT = max(RT), minRT = min(RT), sdRT = sd(RT), meanRT = mean(RT), total_trials = n(), Condition = unique(Condition), TotalTime = sum(RT)/60)\n\nExperimental_Summary_byTRGT <- summarise(group_by(ExperimentalData, Target_Type), propYes = mean(Response), maxRT = max(RT), minRT = min(RT), sdRT = sd(RT), meanRT = mean(RT), total_trials = n(), total_ptpts = length(unique(Participant_Number)))\n\nExperimental_Summary_byCDTN <- summarise(group_by(ExperimentalData, Condition), propYes = mean(Response), numYes = sum(Response),maxRT = max(RT), minRT = min(RT), sdRT = sd(RT), meanRT = mean(RT), total_trials = n(), total_ptpts = length(unique(Participant_Number)))\n\n```\n\n### Overall summary\n```{r Experimental Results Overall}\n\nExperimental_Summary_Overall\n\n```\n\nIt seems as though the overall proportion of yes's is as expected. Max RT is pretty high. Let's take a look at the distribution of RTs.\n\n```{r Overall RT plot, echo = FALSE}\nhist(ExperimentalData$RT, breaks = 1000, main = \"Histogram of overall RT.\", xlab = 'RT')\n```\n\nThis looks good. Skewed shape as expected. Perhaps we should determine a timing cutoff?\n\nIn any case, let's take a look and see if there are RT differences between conditions.\n\n### Summary between conditions.\n\n```{r Experimental Results by Condition}\n\nExperimental_Summary_byCDTN\n\n```\n\nThis looks good. There seems to be fewer \"yes\" reponses in the the passive condition when compared to the active condition. \n\nLet's do a test of proportions to be sure.\n\n```{r Plot of Porportions of Yess, echo=FALSE}\n#calculcate the Standard error for the proportions\nExperimental_Summary_byCDTN$se <- sum(sqrt((Experimental_Summary_byCDTN$propYes*(1 - Experimental_Summary_byCDTN$propYes))/Experimental_Summary_byCDTN$total_trials))\n\n#make the bars slightly separated for visual pleasure\ndodge <- position_dodge(width = 0.5)\n\n#define the error bar limits\nlimits <- aes(ymax = Experimental_Summary_byCDTN$propYes + Experimental_Summary_byCDTN$se,\n              ymin = Experimental_Summary_byCDTN$propYes - Experimental_Summary_byCDTN$se)\n\n#start the plot\np <- ggplot(data =Experimental_Summary_byCDTN, aes(x = Condition, y = propYes))\n\n#now fill the plot\np + geom_bar(stat = \"identity\", position = dodge) +\n  geom_errorbar(limits, position = dodge, width = 0.25) +\n  theme_bw() +\n  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+\n  labs(y = \"Proportion of \\\"Yes\\\" responses\")+\n  ggtitle(\"Proportion of \\\"Yes\\\" responses by Condition\")\n\n#clean up the environment.\nremove(p, dodge, limits)\n\n```\n\n\n```{r test of proportions of yess between Conditons}\n\nprop.test(Experimental_Summary_byCDTN$numYes, Experimental_Summary_byCDTN$total_trials)\n\n```\n\nSure enough, people seem more likely to superstitiously percieve when actively searching for the target. This is definitely worth investigating in other ways!\n\n\nAlso, RT seems to follow the expected outcome. Let's compare the histograms to be sure.\n\n```{r by condition RT plot, echo = FALSE}\n\nplot(density(filter(ExperimentalData, Condition == \"Active\")$RT), main = \"Histogram of Active Condition RT.\", xlab=\"RT\", xlim = c(0,20), ylim=c(0,1.2))\n\nlines(density(filter(ExperimentalData, Condition == \"Passive\")$RT), main = \"Histogram of Passive Condition RT.\", xlab=\"RT\", xlim= c(0,20), ylim=c(0,1.2), col = 'blue')\n\nlegend(\"topright\", legend = levels(filter(TrainingDprimes, Experiment_Phase=='easy')$Condition), lty = c(1,1), col = c('black', 'blue'))\n\n```\n\nA quick t-test confirms.\n\n```{r RT condition-wise t-test}\n\nt.test(RT ~ Condition, data = ExperimentalData)\n\n```\n\n## Analysis of the Image-Wise correlations CI and Prediction\n\nFirst step: aggregate likelihood of image being chosen as a \"yes\" given its correlation with the target.\n\n```{r CI Image-Wise Aggregate}\n#tag the images with similar IW correlations to group them later for aggregation\nExperimentalData_CI <- mutate(ExperimentalData, RelIWCorGroup = cut(CIImageWiseCorrelation, quantile(CIImageWiseCorrelation,p = seq(0,1,length.out = 400))))\n\n#use the RelIWCorGroup above to calculate probYes for each range of IW corrrelation\nExperimental_Summary_byRelIWCor <- summarise(group_by(ExperimentalData_CI, RelIWCorGroup, Condition), IWcor = mean(CIImageWiseCorrelation), pYes = mean(Response))\n```\n\nNow let's go ahead and do the scatter plots so get an idea of the relationships before we do the formal stats. Here we can also identify outliers. \n\n```{r CI IWCor-pYes scatter}\n\npar(mfrow=c(2,1))\n\nwith(filter(Experimental_Summary_byRelIWCor,Condition==\"Active\"), plot(IWcor, pYes, pch=16, cex=0.5, main = \"Active Condition\"))\n\nwith(filter(Experimental_Summary_byRelIWCor,Condition==\"Active\", is.na(RelIWCorGroup)), points(IWcor, pYes, pch=16, cex=0.5, col = 'red'))\n\nwith(filter(Experimental_Summary_byRelIWCor,Condition==\"Passive\"), plot(IWcor, pYes, pch=16, cex=0.5, main = \"Passive Condition\"))\n\npar(mfrow=c(1,1))\n\n```\n\nIt looks like there's a pretty nasty outlier in the Active Condition (Highlighter in red). Let's remove that.\n\n```{r CI IWCor-pYes scatter - removed Outliers}\n\npar(mfrow=c(2,1))\n\nwith(filter(Experimental_Summary_byRelIWCor,Condition==\"Active\", !is.na(RelIWCorGroup)), plot(IWcor, pYes, pch=16, cex=0.5, main = \"Active Condition\"))\n\nwith(filter(Experimental_Summary_byRelIWCor,Condition==\"Passive\"), plot(IWcor, pYes, pch=16, cex=0.5, main = \"Passive Condition\"))\n\npar(mfrow=c(1,1))\n\n```\n\nMuch better. Now we can go ahead and calculate the correlations here.\n\n```{r CI Correlations between Image-Wise correlation and probability of Yes}\nprint(\"Correlation for the Active Condition:\")\nwith(filter(Experimental_Summary_byRelIWCor,Condition==\"Active\", !is.na(RelIWCorGroup)), cor.test(pYes,IWcor))\n\nprint(\"Correlation for the Passive Condition:\")\nwith(filter(Experimental_Summary_byRelIWCor,Condition==\"Passive\"), cor.test(pYes,IWcor))\n```\n\nWow, that's quite a story. People seem to superstitiously see more when actively searching, but they seem to be less correlated to the target they're looking for. That's pretty neat.\n\nLet's just be sure. Let's test that there's a significant difference in correlation between the active and passive groups.\n\n```{r CI Testing Statistical Significance of Active v. Passive Correlation}\n\nActive <- with(filter(Experimental_Summary_byRelIWCor,Condition==\"Active\", !is.na(RelIWCorGroup)), cor.test(pYes,IWcor))\n\nPassive <- with(filter(Experimental_Summary_byRelIWCor,Condition==\"Passive\"), cor.test(pYes,IWcor))\n\nprint(r.test(n=Active$parameter+2, n2 = Passive$parameter+2, r12 = Active$estimate, r34 = Passive$estimate))\n\nremove(Active, Passive)\n```\n\nGood, that I is dotted. \n\nLet's plot them together to directly compare them. Lines of best fit are included and colour coded.\n\n```{r CI Analysis Image-Wise Cor Plot, echo=FALSE}\nwith(filter(Experimental_Summary_byRelIWCor,Condition==\"Active\", !is.na(RelIWCorGroup)), plot(IWcor, pYes, pch=16, cex=0.5, ylim = c(0,1), col = 'red', ylab = \"Proportion of \\\"yes\\\" responses by participants\", xlab = \"Image-wise correlation between trial image and target image\"))\nwith(filter(Experimental_Summary_byRelIWCor,Condition==\"Active\", !is.na(RelIWCorGroup)), abline(lm(pYes ~ IWcor), col = 'red'))\n\nwith(filter(Experimental_Summary_byRelIWCor,Condition==\"Passive\"), points(IWcor, pYes, pch=16, cex=0.5, col='blue'))\nwith(filter(Experimental_Summary_byRelIWCor,Condition==\"Passive\"), abline(lm(pYes ~ IWcor), col='blue'))\n\nlegend(\"topright\", legend = levels(filter(TrainingDprimes, Experiment_Phase=='easy')$Condition), pch = c(15,15), pt.cex = c(2,2), col = c('red', 'blue'))\n```\n\n\n\n\n## Analysis of the Image-Wise correlations and Prediction\n\nFirst step: aggregate likelihood of image being chosen as a \"yes\" given its correlation with the target.\n\n```{r Image-Wise Aggregate}\n#tag the images with similar IW correlations to group them later for aggregation\nExperimentalData <- mutate(ExperimentalData, RelIWCorGroup = cut(RelevantImageWiseCorrelation, quantile(RelevantImageWiseCorrelation,p = seq(0,1,length.out = 400))))\n\n#use the RelIWCorGroup above to calculate probYes for each range of IW corrrelation\nExperimental_Summary_byRelIWCor <- summarise(group_by(ExperimentalData, RelIWCorGroup, Condition), IWcor = mean(RelevantImageWiseCorrelation), pYes = mean(Response))\n```\n\nNow let's go ahead and do the scatter plots so get an idea of the relationships before we do the formal stats. Here we can also identify outliers. \n\n```{r IWCor-pYes scatter}\n\npar(mfrow=c(2,1))\n\nwith(filter(Experimental_Summary_byRelIWCor,Condition==\"Active\"), plot(IWcor, pYes, pch=16, cex=0.5, main = \"Active Condition\"))\n\nwith(filter(Experimental_Summary_byRelIWCor,Condition==\"Active\", is.na(RelIWCorGroup)), points(IWcor, pYes, pch=16, cex=0.5, col = 'red'))\n\nwith(filter(Experimental_Summary_byRelIWCor,Condition==\"Passive\"), plot(IWcor, pYes, pch=16, cex=0.5, main = \"Passive Condition\"))\n\npar(mfrow=c(1,1))\n\n```\n\nIt looks like there's a pretty nasty outlier in the Active Condition (Highlighter in red). Let's remove that.\n\n```{r IWCor-pYes scatter - removed Outliers}\n\npar(mfrow=c(2,1))\n\nwith(filter(Experimental_Summary_byRelIWCor,Condition==\"Active\", !is.na(RelIWCorGroup)), plot(IWcor, pYes, pch=16, cex=0.5, main = \"Active Condition\"))\n\nwith(filter(Experimental_Summary_byRelIWCor,Condition==\"Passive\"), plot(IWcor, pYes, pch=16, cex=0.5, main = \"Passive Condition\"))\n\npar(mfrow=c(1,1))\n\n```\n\nMuch better. Now we can go ahead and calculate the correlations here.\n\n```{r Correlations between Image-Wise correlation and probability of Yes}\nprint(\"Correlation for the Active Condition:\")\nwith(filter(Experimental_Summary_byRelIWCor,Condition==\"Active\", !is.na(RelIWCorGroup)), cor.test(pYes,IWcor))\n\nprint(\"Correlation for the Passive Condition:\")\nwith(filter(Experimental_Summary_byRelIWCor,Condition==\"Passive\"), cor.test(pYes,IWcor))\n```\n\nWow, that's quite a story. People seem to superstitiously see more when actively searching, but they seem to be less correlated to the target they're looking for. That's pretty neat.\n\nLet's just be sure. Let's test that there's a significant difference in correlation between the active and passive groups.\n\n```{r Testing Statistical Significance of Active v. Passive Correlation}\n\nActive <- with(filter(Experimental_Summary_byRelIWCor,Condition==\"Active\", !is.na(RelIWCorGroup)), cor.test(pYes,IWcor))\n\nPassive <- with(filter(Experimental_Summary_byRelIWCor,Condition==\"Passive\"), cor.test(pYes,IWcor))\n\nprint(r.test(n=Active$parameter+2, n2 = Passive$parameter+2, r12 = Active$estimate, r34 = Passive$estimate))\n\nremove(Active, Passive)\n```\n\nGood, that I is dotted. \n\nLet's plot them together to directly compare them. Lines of best fit are included and colour coded.\n\n```{r Analysis Image-Wise Cor Plot, echo=FALSE}\nwith(filter(Experimental_Summary_byRelIWCor,Condition==\"Active\", !is.na(RelIWCorGroup)), plot(IWcor, pYes, pch=16, cex=0.5, ylim = c(0,1), col = 'red', ylab = \"Proportion of \\\"yes\\\" responses by participants\", xlab = \"Image-wise correlation between trial image and target image\"))\nwith(filter(Experimental_Summary_byRelIWCor,Condition==\"Active\", !is.na(RelIWCorGroup)), abline(lm(pYes ~ IWcor), col = 'red'))\n\nwith(filter(Experimental_Summary_byRelIWCor,Condition==\"Passive\"), points(IWcor, pYes, pch=16, cex=0.5, col='blue'))\nwith(filter(Experimental_Summary_byRelIWCor,Condition==\"Passive\"), abline(lm(pYes ~ IWcor), col='blue'))\n\nlegend(\"topright\", legend = levels(filter(TrainingDprimes, Experiment_Phase=='easy')$Condition), pch = c(15,15), pt.cex = c(2,2), col = c('red', 'blue'))\n```\n\n",
    "created" : 1480377059976.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "4|3|12|0|\n16|0|20|0|\n64|76|110|0|\n112|73|179|0|\n181|30|194|0|\n",
    "hash" : "3933742878",
    "id" : "5EC73059",
    "lastKnownWriteTime" : 1486170134,
    "last_content_update" : 1487102841470,
    "path" : "~/Dropbox/Reverse_Correlation/R Analysis/Experiment 3 Analysis.Rmd",
    "project_path" : "Experiment 3 Analysis.Rmd",
    "properties" : {
        "docOutlineVisible" : "1",
        "tempName" : "Untitled1"
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}