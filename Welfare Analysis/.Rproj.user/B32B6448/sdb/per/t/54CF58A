{
    "collab_server" : "",
    "contents" : "library(rcicr)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(cowplot)\nlibrary(psych)\nlibrary(jpeg)\nlibrary(imager)\n\n\nwelfaredata <- read.csv(\"Study1_ReverseCorrelationDataLongForm_codedmissingvalues.csv\")\n\n# Recode responses\n# 1 = Positive stim\n# 0 = Negative stim\nwelfaredata$response <- (welfaredata$response * 2) - 1\n\n# Indicate repeated trials (pic > 400)\nwelfaredata <- subset(welfaredata, pic <= 400)\nwelfareCIs <- batchGenerateCI2IFC(welfaredata, 'SubjectID', 'pic', 'response', 'pat3', './4138635/R Materials for CIs/kp1_seed_NA_time_Jan_22_2015_12_24.Rdata')\nwelfareantiCIs <- batchGenerateCI2IFC(welfaredata, 'SubjectID', 'pic', 'response', 'pat3', './4138635/R Materials for CIs/kp1_seed_NA_time_Jan_22_2015_12_24.Rdata', antiCI = T)\nnames(welfareantiCIs) <- paste0(names(welfareantiCIs), \"_anti\")\n\ngroupCIs <- list(\n  welfare=generateCI2IFC(welfaredata$pic, welfaredata$response, 'pat3', './4138635/R Materials for CIs/kp1_seed_NA_time_Jan_22_2015_12_24.Rdata'),\n  antiwelfare=generateCI2IFC(welfaredata$pic, welfaredata$response, 'pat3', './4138635/R Materials for CIs/kp1_seed_NA_time_Jan_22_2015_12_24.Rdata', antiCI = T)\n)\n\ngroupCIs <- autoscale(groupCIs, saveasjpegs = T)\n\np <- generateNoisePattern(img_size)\npb <- dplyr::progress_estimated(400)\n\nstimuli <- matlab::zeros(img_size, img_size, n_trials)\nfor(i in 0:399){\n  pb$tick()$print()\n  stimuli[, , i+1] <- generateNoiseImage(t(stimuli_params[[\"pat3\"]][i+1,]), p)\n  \n  stimulus <- ((stimuli[, , i+1] + 0.3)/0.6)\n  combined <- (stimulus + base_faces[['pat3']])/2\n  jpeg::writeJPEG(combined, paste(stimulus_path, paste(label, \n                                                       base_faces[[\"pat3\"]], sprintf(\"%05d_ori.jpg\", i), \n                                                       sep = \"_\"), sep = \"/\"), quality = 1)\n  stimulus <- ((-stimuli[, , i+1] + 0.3)/0.6)\n  stimulus <- (stimulus + base_faces[['pat3']])/2\n  jpeg::writeJPEG(stimulus, paste(stimulus_path, paste(label, \n                                                       base_faces[[\"pat3\"]], sprintf(\"%05d_inv.jpg\", i), \n                                                       sep = \"_\"), sep = \"/\"), quality = 1)\n}\n\n\n\n\n\n\nCI <- matrix(load.image(\"./cis/ci_pat3.jpg\"), nrow=512)\nantiCI <- matrix(load.image(\"./cis/antici_pat3.jpg\"), nrow=512)\n\nposcor <- c()\nnegcor <- c()\n\npb <- dplyr::progress_estimated(400)\n\nfor(i in 0:399){\n  \n  pb$tick()$print()\n  \n  pos <- matrix(load.image(paste(\"MyGennedStims/kp1_0.994736842105263\", sprintf(\"%05d_ori.jpg\", i), sep='_')), nrow=512)\n  \n  neg <- matrix(load.image(paste(\"MyGennedStims/kp1_0.994736842105263\", sprintf(\"%05d_inv.jpg\", i), sep='_')), nrow=512)\n\n  poscor <- c(poscor, cor(c(CI), c(pos)))\n  \n  negcor <- c(negcor, cor(c(CI), c(neg)))\n}\n\n\ncor(rep(poscor-negcor, times = 121)[welfaredata$response!=1997], welfaredata$response[welfaredata$response!=1997])\n\neff <- effsize::cohen.d(rep(poscor-negcor, times=123)[(welfaredata$response %in% c(-1,1))], as.factor(welfaredata$response[(welfaredata$response %in% c(-1,1))]))\n\nCorrelation_btw_CI_and_img <- welfaredata[(welfaredata$response %in% c(-1,1)),]\nCorrelation_btw_CI_and_img$response <- as.factor(Correlation_btw_CI_and_img$response)\nlevels(Correlation_btw_CI_and_img$response) <- c(\"no\", \"yes\")\ncorrelation <- rep(poscor, times = 123)[(welfaredata$response %in% c(-1,1))]\nggplot(Correlation_btw_CI_and_img, aes(correlation, colour = Correlation_btw_CI_and_img$response)) + stat_ecdf() + labs(list(title = paste(\"Effect Size:\", eff$estimate, sep = ' '), x = \"Correlation between Image and CI\", y = \"Proportion of Total\", colour = \"Response\"))\n\nbins <- pretty(poscor-negcor,n = 10)\n\ncorDifs <- poscor-negcor\n\nfreq <- c()\n\nfor(i in 1:(length(bins)-1)){\n  \n  ID <- which(corDifs>bins[i] & corDifs < bins[i+1])\n  \n  freq <- c(freq, mean(welfaredata$response[(welfaredata$pic %in% ID) & welfaredata$response!=999]))\n  \n}\n\nplot(bins[-1], freq, type='l')\nlines(y=rep(0.5, times=2), x=c(min(bins)+0.5*min(bins), max(bins)+0.5*max(bins)),col='red')\n\n\n#---- Study 1 ---- \n\nwelfaredata <- read.csv(\"Study1_ReverseCorrelationDataLongForm_codedmissingvalues.csv\")\n\n# Recode responses\n# 1 = Positive stim\n# 0 = Negative stim\nwelfaredata$response <- (welfaredata$response * 2) - 1\n\n# Indicate repeated trials (pic > 400)\nwelfaredata <- subset(welfaredata, pic <= 400)\n\ngroupCIs <- list(\n  welfare=generateCI2IFC(welfaredata$pic, welfaredata$response, 'pat3', './4138635/R Materials for CIs/kp1_seed_NA_time_Jan_22_2015_12_24.Rdata'),\n  antiwelfare=generateCI2IFC(welfaredata$pic, welfaredata$response, 'pat3', './4138635/R Materials for CIs/kp1_seed_NA_time_Jan_22_2015_12_24.Rdata', antiCI = T)\n)\n\nCI <- matrix(load.image(\"./cis/ci_pat3_1.jpg\"), nrow=512)\nantiCI <- matrix(load.image(\"./cis/antici_pat3_1.jpg\"), nrow=512)\n\nposcor <- c()\nnegcor <- c()\n\npb <- dplyr::progress_estimated(400)\n\nfor(i in 0:399){\n  \n  pb$tick()$print()\n  \n  pos <- matrix(load.image(paste(\"MyGennedStims/kp1_0.994736842105263\", sprintf(\"%05d_ori.jpg\", i), sep='_')), nrow=512)\n  \n  neg <- matrix(load.image(paste(\"MyGennedStims/kp1_0.994736842105263\", sprintf(\"%05d_inv.jpg\", i), sep='_')), nrow=512)\n  \n  poscor <- c(poscor, cor(c(CI), c(pos)))\n  \n  negcor <- c(negcor, cor(c(CI), c(neg)))\n}\n\neff <- effsize::cohen.d(rep(poscor-negcor, times=121)[(welfaredata$response %in% c(-1,1))], as.factor(welfaredata$response[(welfaredata$response %in% c(-1,1))]))\n\nCorrelation_btw_CI_and_img <- welfaredata[(welfaredata$response %in% c(-1,1)),]\nCorrelation_btw_CI_and_img$response <- as.factor(Correlation_btw_CI_and_img$response)\nlevels(Correlation_btw_CI_and_img$response) <- c(\"no\", \"yes\")\ncorrelation <- rep(poscor-negcor, times = 121)[(welfaredata$response %in% c(-1,1))]\nggplot(Correlation_btw_CI_and_img, aes(correlation, colour = Correlation_btw_CI_and_img$response)) + stat_ecdf() + labs(list(title = paste(\"Effect Size:\", eff$estimate, sep = ' '), x = \"Correlation between Image and CI\", y = \"Proportion of Total\", colour = \"Response\"))\n\n#--- predictions\n\nstimprams <- stimuli_params$pat3\n\nwelfaregroup <- group_by(filter(welfaredata, response %in% c(-1,1)), pic)\n\navImdiff <- welfaregroup$response %*% do.call(rbind, replicate(121, as.matrix(stimprams), simplify=FALSE))[welfaredata$response %in% c(-1,1),]\navImdiff <- avImdiff-min(avImdiff)\navImdiff <- avImdiff/max(avImdiff)\navImdiff <- avImdiff*2 -1\n\nsinusioudCorsdiff <- cor(t(avImdiff), t(stimprams))\n\nPyes <- summarise(welfaregroup, mean = mean(response*0.5+0.5))\n\ncor(t(sinusioudCorsdiff), Pyes$mean)\n\neffsize::cohen.d(rep(t(sinusioudCors),times=121)[welfaredata$response!=1997], as.factor(welfaregroup$response))\n\ncor(rep(t(sinusioudCors),times=121)[welfaredata$response!=1997], welfaregroup$response)\n\nplot(t(sinusioudCorsdiff), Pyes$mean, ylim=c(0,1))\nabline(lm(Pyes$mean~t(sinusioudCorsdiff)), col='blue')\nabline(0.5,0, col='red')\ntitle(main=\"Study1 - pred Welfare\")\n\n\n#---- Study 2 -----\n\nwelfaredata <- read.csv(\"Study2_ReverseCorrelations_Welfare_LongForm.csv\")\n\n# Recode responses\n# 1 = Positive stim\n# 0 = Negative stim\nwelfaredata$response <- (welfaredata$response * 2) - 1\n\n# Indicate repeated trials (pic > 400)\nwelfaredata <- subset(welfaredata, pic <= 400)\n\ngroupCIs <- list(\n  welfare=generateCI2IFC(welfaredata$pic, welfaredata$response, 'pat3', './4138635/R Materials for CIs/kp1_seed_NA_time_Jan_22_2015_12_24.Rdata'),\n  antiwelfare=generateCI2IFC(welfaredata$pic, welfaredata$response, 'pat3', './4138635/R Materials for CIs/kp1_seed_NA_time_Jan_22_2015_12_24.Rdata', antiCI = T)\n)\n\nCI <- matrix(load.image(\"./cis/ci_pat3_2a.jpg\"), nrow=512)\nantiCI <- matrix(load.image(\"./cis/antici_pat3_2a.jpg\"), nrow=512)\n\nposcor <- c()\nnegcor <- c()\n\npb <- dplyr::progress_estimated(400)\n\nfor(i in 0:399){\n  \n  pb$tick()$print()\n  \n  pos <- matrix(load.image(paste(\"MyGennedStims/kp1_0.994736842105263\", sprintf(\"%05d_ori.jpg\", i), sep='_')), nrow=512)\n  \n  neg <- matrix(load.image(paste(\"MyGennedStims/kp1_0.994736842105263\", sprintf(\"%05d_inv.jpg\", i), sep='_')), nrow=512)\n  \n  poscor <- c(poscor, cor(c(CI), c(pos)))\n  \n  negcor <- c(negcor, cor(c(CI), c(neg)))\n}\n\neff <- effsize::cohen.d(rep(poscor-negcor, times=123)[(welfaredata$response %in% c(-1,1))], as.factor(welfaredata$response[(welfaredata$response %in% c(-1,1))]))\n\nCorrelation_btw_CI_and_img <- welfaredata[(welfaredata$response %in% c(-1,1)),]\nCorrelation_btw_CI_and_img$response <- as.factor(Correlation_btw_CI_and_img$response)\nlevels(Correlation_btw_CI_and_img$response) <- c(\"no\", \"yes\")\ncorrelation <- rep(poscor-negcor, times = 123)[(welfaredata$response %in% c(-1,1))]\nggplot(Correlation_btw_CI_and_img, aes(correlation, colour = Correlation_btw_CI_and_img$response)) + stat_ecdf() + labs(list(title = paste(\"Effect Size:\", abs(eff$estimate), sep = ' '), x = \"Correlation between Image and CI\", y = \"Proportion of Total\", colour = \"Response\"))\n\n#--- predictions\n\nstimprams <- stimuli_params$pat3\n\navImdiff <- welfaregroup$response %*% do.call(rbind, replicate(123, as.matrix(stimprams), simplify=FALSE))[welfaredata$response %in% c(-1,1),]\navImdiff <- avImdiff-min(avImdiff)\navImdiff <- avImdiff/max(avImdiff)\navImdiff <- avImdiff*2 -1\n\nsinusioudCorsdiff <- cor(t(avImdiff), t(stimprams))\n\nwelfaregroup <- group_by(filter(welfaredata, response %in% c(-1,1)), pic)\n\nPyes <- summarise(welfaregroup, mean = mean(response*0.5+0.5))\n\ncor(t(sinusioudCorsdiff), Pyes$mean)\n\n\neffsize::cohen.d(rep(t(sinusioudCors),times=121)[welfaredata$response!=1997], as.factor(welfaregroup$response))\n\ncor(rep(t(sinusioudCors),times=121)[welfaredata$response!=1997], welfaregroup$response)\n\nplot(t(sinusioudCorsdiff), Pyes$mean, ylim=c(0,1))\nabline(lm(Pyes$mean~t(sinusioudCorsdiff)), col='blue')\nabline(0.5,0, col='red')\ntitle(main=\"Study2 - pred Welfare with study1 CI\")\n\n\nstimuli <- generateNoiseImage(t(avImdiff), p)\n\nstimulus <- ((stimuli + 0.3)/0.6)\ncombined <- (stimulus + base_faces[['pat3']])/2\n\ncombined <- combined - min(combined)\n\ncombined <- combined/max(combined)\njpeg::writeJPEG(combined, paste( paste(label, \n                                       base_faces[[\"pat3\"]], sprintf(\"%05d_ori.jpg\", i), \n                                       sep = \"_\"), sep = \"/\"), quality = 1)\nstimulus <- ((-1*stimuli + 0.3)/0.6)\n\ncombined <- (stimulus + base_faces[['pat3']])/2\n\ncombined <- combined - min(combined)\n\ncombined <- combined/max(combined)\n\njpeg::writeJPEG(combined, paste( paste(label, \n                                       base_faces[[\"pat3\"]], sprintf(\"%05d_inv.jpg\", i), \n                                       sep = \"_\"), sep = \"/\"), quality = 1)\n\n\n\n#------ Study2b\n\nwelfaredata <- read.csv(\"Study2_ReverseCorrelations_NonWelfare_LongForm.csv\")\n\n# Recode responses\n# 1 = Positive stim\n# 0 = Negative stim\nwelfaredata$response <- (welfaredata$response * 2) - 1\n\n# Indicate repeated trials (pic > 400)\nwelfaredata <- subset(welfaredata, pic <= 400)\n\ngroupCIs <- list(\n  welfare=generateCI2IFC(welfaredata$pic, welfaredata$response, 'pat3', './4138635/R Materials for CIs/kp1_seed_NA_time_Jan_22_2015_12_24.Rdata'),\n  antiwelfare=generateCI2IFC(welfaredata$pic, welfaredata$response, 'pat3', './4138635/R Materials for CIs/kp1_seed_NA_time_Jan_22_2015_12_24.Rdata', antiCI = T)\n)\n\nCI <- matrix(load.image(\"./cis/ci_pat3_2b.jpg\"), nrow=512)\nantiCI <- matrix(load.image(\"./cis/antici_pat3_2b.jpg\"), nrow=512)\n\nposcor <- c()\nnegcor <- c()\n\npb <- dplyr::progress_estimated(400)\n\nfor(i in 0:399){\n  \n  pb$tick()$print()\n  \n  pos <- matrix(load.image(paste(\"MyGennedStims/kp1_0.994736842105263\", sprintf(\"%05d_ori.jpg\", i), sep='_')), nrow=512)\n  \n  neg <- matrix(load.image(paste(\"MyGennedStims/kp1_0.994736842105263\", sprintf(\"%05d_inv.jpg\", i), sep='_')), nrow=512)\n  \n  poscor <- c(poscor, cor(c(CI), c(pos)))\n  \n  negcor <- c(negcor, cor(c(CI), c(neg)))\n}\n\neff <- effsize::cohen.d(rep(poscor-negcor, times=115)[(welfaredata$response %in% c(-1,1))], as.factor(welfaredata$response[(welfaredata$response %in% c(-1,1))]))\n\nCorrelation_btw_CI_and_img <- welfaredata[(welfaredata$response %in% c(-1,1)),]\nCorrelation_btw_CI_and_img$response <- as.factor(Correlation_btw_CI_and_img$response)\nlevels(Correlation_btw_CI_and_img$response) <- c(\"no\", \"yes\")\ncorrelation <- rep(poscor-negcor, times = 115)[(welfaredata$response %in% c(-1,1))]\nggplot(Correlation_btw_CI_and_img, aes(correlation, colour = Correlation_btw_CI_and_img$response)) + stat_ecdf() + labs(list(title = paste(\"Effect Size:\", abs(eff$estimate), sep = ' '), x = \"Correlation between Image and CI\", y = \"Proportion of Total\", colour = \"Response\"))\n\n\n\npb <- dplyr::progress_estimated(400)\n\nstimprams <- stimuli_params$pat3\n\navImdiff <- welfaregroup$response %*% do.call(rbind, replicate(115, as.matrix(stimprams), simplify=FALSE))[welfaredata$response %in% c(-1,1),]\navImdiff <- avImdiff-min(avImdiff)\navImdiff <- avImdiff/max(avImdiff)\navImdiff <- avImdiff*2 -1\n\nsinusioudCorsdiff <- cor(t(avImdiff), t(stimprams))\n\nwelfaregroup <- group_by(filter(welfaredata, response %in% c(-1,1)), pic)\n\nPyes <- summarise(welfaregroup, mean = mean(response*0.5+0.5))\n\ncor(t(sinusioudCorsdiff), Pyes$mean)\n\neffsize::cohen.d(rep(t(sinusioudCors),times=121)[welfaredata$response!=1997], as.factor(welfaregroup$response))\n\ncor(rep(t(sinusioudCors),times=121)[welfaredata$response!=1997], welfaregroup$response)\n\nplot(t(sinusioudCorsdiff), Pyes$mean, ylim=c(0,1))\nabline(lm(Pyes$mean~t(sinusioudCorsdiff)), col='blue')\nabline(0.5,0, col='red')\ntitle(main=\"Study2 - pred Non-welfare with Study1 CI\")\n\n  stimuli <- generateNoiseImage(t(avImdiff), p)\n  \n  stimulus <- ((stimuli + 0.3)/0.6)\n  combined <- (stimulus + base_faces[['pat3']])/2\n  \n  combined <- combined - min(combined)\n  \n  combined <- combined/max(combined)\n  jpeg::writeJPEG(combined, paste( paste(label, \n                                                       base_faces[[\"pat3\"]], sprintf(\"%05d_ori.jpg\", i), \n                                                       sep = \"_\"), sep = \"/\"), quality = 1)\n  stimulus <- ((-1*stimuli + 0.3)/0.6)\n  \n  combined <- (stimulus + base_faces[['pat3']])/2\n  \n  combined <- combined - min(combined)\n  \n  combined <- combined/max(combined)\n  \n  jpeg::writeJPEG(combined, paste( paste(label, \n                                  base_faces[[\"pat3\"]], sprintf(\"%05d_inv.jpg\", i), \n                                  sep = \"_\"), sep = \"/\"), quality = 1)\n\n",
    "created" : 1481308297366.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3125272924",
    "id" : "54CF58A",
    "lastKnownWriteTime" : 1481830484,
    "last_content_update" : 1481830484041,
    "path" : "~/Dropbox/Reverse_Correlation/Welfare Analysis/Predict Responses.R",
    "project_path" : "Predict Responses.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}